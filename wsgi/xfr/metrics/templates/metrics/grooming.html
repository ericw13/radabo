{% extends 'metrics/base.html' %}
{% block pagetitle %}Projects{% endblock %}
{% block title %}
<div class="row">
  <div class="col-sm-2"></div>
  <div class="col-sm-8">
    <h2>{{header}}</h2>
  </div>
  <div class="col-sm-2"></div>
</div>
{% endblock %}
{% block primary %}
  <div class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8" style="float: left">
    {% regroup story by track as sorted_story %}
    {% if story %}
      <table class="publish" cellpadding="5">
        <tr>
          <th class="publish" >Track</th>
          <th class="publish">Business Area</th>
          <th class="left">Name</th>
          <th class="left">Process Lead</th>
          <th class="left">User Story</th>
          <th class="left">Status</th>
        </tr>
        {% for x in sorted_story %}
            {% for y in x.list %} 
              {% if y.blocked == "Y" %}
              <tr class="alert-danger">
              {% else %}
              <tr>
              {% endif %}
              {% if forloop.first %}
                 <td class="first" rowspan="{{ forloop.revcounter }}">{{ x.grouper|default_if_none:"Unknown" }}</td>
              {% endif %}
              <td class="center" style="width: 8%">{{ y.module|default_if_none:"All" }} </td>
              <td class="publish" style="width: 25%">
                {{ y.description }}{% if y.blocked == "Y" %}&nbsp;<span class="glyphicon glyphicon-ban-circle"></span>{% endif %}</td>
              <td class="publish" style="width: 10%">{{ y.globalLead|default_if_none:"" }}</td>
              <td class="publish" style="width: 8%"><a href="{{ y.storyURL }}" target="_blank">{{ y.rallyNumber }}</a></td>
              <td class="publish" style="width: 10%">{{ y.get_status_display }}</td>
            </tr>
            {% endfor %}
        {% endfor %}
        </tr></table>
      {% else %}
        <p>{{ exception }}
      {% endif %}
    </div>
    <div class="col-sm-2"></div>
  </div>
{% endblock %}
