{% extends 'metrics/base.html' %}
{% block pagetitle %}User Stories{% endblock %}
{% block title %}{{ header }}{% endblock %}
{% block js %}{% endblock %}
{% block picker %}
  {% if list %}
<!-- old form
    <form name=relForm action="" method=POST>
    {% csrf_token %}
      <p>
        <select name=choice onchange="relForm.submit();">
          {% for name in list %}
            <option value="{{ name }}" {% if name == current %}selected{% endif %}>{{name}}</value>
          {% endfor %}
        </select>
      </p>
    </form>
-->
    <form name="relForm" id="relForm" action="" method=POST>
      {% csrf_token %}
      <div class="dropdown dropdown-submit-input">
        <input class="span2" id="choice" name="choice" type="hidden">
        <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-toggle="dropdown">Select Timebox<span class="caret"></span></button>
        <ul class="dropdown-menu">
        {% for name in list %}
          <li><button class="form-control btn btn-link" style="width:auto;" type="submit" name="choice" value="{{name}}">{{name}}</button></li>
        {% endfor %}
        </ul>
      </div>
    </form>
  {% endif %}
{% endblock %}
{% block primary %}
  {% regroup story by get_businessValue_display as sorted_story %}
  <div style="float: left">
  {% if story %}
      <table class="publish">
        <thead>
          <tr>
            <th class="left">Business Value</th>
            <th class="left">Name</th>
            <th class="publish">Business Area</th>
            <th class="publish">Solution Size</th>
            <th class="publish">Track</th>
            <th class="left">Stakeholders</th>
            {% if gpo == "Y" %}
            <th class="left">Process Lead</th>
            {% endif %}
            <th class="left">User Story</th>
          </tr>
        </thead>
        {% for x in sorted_story %}
            {% for y in x.list %} 
              <tr>
              {% if forloop.first %}
                 <td class="first" rowspan="{{ forloop.revcounter }}">{{ x.grouper }}</td>
              {% endif %}
              <td class="publish" style="width: 25%">
                 {% if y.blocked == "Y" %}<p class="bg-danger"><b>BLOCKED: </b>{% else %}<p>{% endif%}{{ y.description }}</p></td>
              <td class="center" style="width: 8%">{{ y.module }} </td>
              <td class="center" style="width: 8%">{{ y.solutionSize }}</td>
              <td class="center" style="width: 3%">{{ y.track }}</td>
              <td class="publish" style="width: 10%">{{ y.stakeholders|default_if_none:"" }}</td>
              {% if gpo == "Y" %}
              <td class="publish" style="width: 10%">{{ y.globalLead|default_if_none:"" }}</td>
              {% endif %}
              <td class="publish" style="width: 8%"><a href="{{ y.storyURL }}" target="_blank">{{ y.rallyNumber }}</a></td>
            </tr>
            {% endfor %}
        {% endfor %}
        </tr></table>
    {% else %}
      <p>{{ exception }}
    {% endif %}
    </div>
{% endblock %}
